<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		SSO
		<script type="text/javascript">
			window.addEventListener('message',(e) => {
				/**
				 * 安全设置，只接受特定发过来的网址
				 * */
				// 
				let url1 = 'http://127.0.0.1:8848'
			    if(e.origin !== url1)
			    return;
				
				/**
				 * 发zyyz进行验证，验证cookie有没有值，如果有值测说明已经登录
				 * 有值返回1
				 * 没值放回0
				 * */
			    if(e.data == 'zyyz'){
					let value = getCookie("message") == '' ? '0':'1'
					window.parent.postMessage(value, e.origin);
					
				}
				if(e.data.indexOf('message,') == 0){
					setCookie('message',e.data,1);
					console.log("设置coolie");
					window.parent.postMessage("设置cookie成功",e.origin)
				}
			 
			    // 发送消息给domain1
			    // window.parent.postMessage('来自SSO的消息', e.origin);
			}, false);
			/**
			 * 设置cookie方法
			 * */
			function setCookie(cname,cvalue,exdays){
			    var d = new Date();
			    d.setTime(d.getTime()+(exdays*24*60*60*1000));
			    var expires = "expires="+d.toGMTString();
			    document.cookie = cname+"="+cvalue+"; "+expires;
			}
			/**
			 * 得到cookie方法
			 * */
			function getCookie(cname){
			    var name = cname + "=";
			    var ca = document.cookie.split(';');
			    for(var i=0; i<ca.length; i++) {
			        var c = ca[i].trim();
			        if (c.indexOf(name)==0) { return c.substring(name.length,c.length); }
			    }
			    return "";
			}
		</script>
	</body>
</html>
